<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article">
  
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>Lua Reference - kong.dao - v0.2.x | Qordoba - Strings Intelligence Platform..</title>
  <meta name="description" content="Create a fully automated strings management solution">
  <meta name="author" content="Qordoba"/>
  <meta property="og:title" content="Strings Intelligence Platform.."/>
  <meta property="og:site_name" content="Qordoba"/>
  
  <link rel="icon" type="image/x-icon" href="/assets/images/favicon.png"/>
  <link rel="stylesheet" href="/assets/styles.css?v=1545351571"/>
</head>


  <body id="" >
    <header class="site-header">
  <div class="enterprise">
        <div class="container">
       <nav class="enterprise-sites one-half column">
         <ul>
           <li>
             <a href="https://qordoba.com/customers/" target="_blank">Customers</a>
           </li>
           <li>
             <a href="https://qordoba.com/partners/" target="_blank" >Partners</a>
           </li>
         </ul>
       </nav>   
      <nav class="enterprise-contact one-half column">
        <ul>
          <li>
            <a href="https://support.qordoba.com/" target="_blank">Support</a>
          </li>
          <li>
            <a href="http://go.qordoba.com/WF-Request-A-Demo__LP-DevDocs-Header.html">Request Demo</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <!-- .enterprise -->
  <div class="navbar">
    <div class="container">
      <a href="/" class="navbar-brand">
        <img src="/assets/images/qordoba-white-logo.png" alt="Qordoba" style="height: 35px;" >
      </a>
      <button data-toggle="collapse" data-target="#navbar" aria-expanded="true" aria-controls="navbar" class="navbar-toggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <nav id="navbar" class="navbar-nav">
        <ul>
          <li>
            <a href="/docs/"  class="active" >Docs</a>
          </li>
          <li>
            <a href="/ecosystem" >Ecosystem</a>

          </li>
          <li>
            <a href="/security/" >Security</a>
          </li>
         
           <li>
            <a href="https://app.qordoba.com/docs/swagger-ui/index.html?url=/assets/swagger.json#!/routes/orgList">API</a>
          </li>
          <li>

            <a href="/install/" class="button button-dark" data-analytics='{"event": "Clicked download", "type": "button", "location": "header"}'>Installation</a>

          </li>
        </ul>
      </nav>
    </div>
  </div>
  <!-- .navbar -->
</header>


    <header class="page-header">
  <div class="container">
    <div class="page-header-icon">
      <img src="/assets/images/icons/icn-documentation.svg" alt="Documentation" />
    </div>
    <div class="page-header-title">
      <h1>Public Lua API Reference</h1>
      <p>For plugins developers and core contributors</p>
    </div>
    
  </div>
</header>

<div class="container">
  <aside class="page-navigation">
    <nav>
      <ul>
        <li>
          <a href="/docs/"><h5>Back to docs</h5></a>
        </li>
        <li>
          <a href="/docs//lua-reference/"><h5>Index</h5></a>
        </li>
        <li>
          <h5>Modules</h5>
          <ul>
            <li>kong.dao</li>
            <li><a href="../../modules/kong.plugins.basic-auth.crypto">kong.plugins.basic-auth.crypto</a></li>
            <li><a href="../../modules/kong.plugins.galileo.alf">kong.plugins.galileo.alf</a></li>
            <li><a href="../../modules/kong.plugins.galileo.buffer">kong.plugins.galileo.buffer</a></li>
            <li><a href="../../modules/kong.plugins.jwt.jwt_parser">kong.plugins.jwt.jwt_parser</a></li>
            <li><a href="../../modules/kong.tools.responses">kong.tools.responses</a></li>
            <li><a href="../../modules/kong.tools.timestamp">kong.tools.timestamp</a></li>
            <li><a href="../../modules/kong.tools.utils">kong.tools.utils</a></li>
            <li><a href="../../modules/spec.helpers">spec.helpers</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </aside>

  <div class="page-content-container">
  <div class="page-content">
    <div class="content">
<h1><code>kong.dao</code></h1>
<p>Operates over entities of a given type in a database table.</p>
<p>An instance of this class is to be instanciated for each entity, and can interact
 with the table representing the entity in the database.</p>

<p> Instanciations of this class are managed by the DAO Factory.</p>

<p> This class provides an abstraction for various databases (PostgreSQL, Cassandra)
 and is responsible for propagating clustering events related to data invalidation,
 as well as foreign constraints when the underlying database does not support them
 (as with Cassandra).</p>


<h3>Info:</h3>
<ul>
</ul>

<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
  <tr>
    <td class="name"><a href="#DAO:count">DAO:count (tbl)</a></td>
    <td class="summary">Count the number of rows.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:delete">DAO:delete (tbl)</a></td>
    <td class="summary">Delete a row.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:find">DAO:find (tbl)</a></td>
    <td class="summary">Find a row.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:find_all">DAO:find_all (tbl)</a></td>
    <td class="summary">Find all rows.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:find_page">DAO:find_page (tbl, page_offset, page_size)</a></td>
    <td class="summary">Find a paginated set of rows.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:insert">DAO:insert (tbl, options)</a></td>
    <td class="summary">Insert a row.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:new">DAO:new (db, model_mt, schema, constraints)</a></td>
    <td class="summary">Instanciate a DAO.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:update">DAO:update (tbl, filter_keys, options)</a></td>
    <td class="summary">Update a row.</td>
  </tr>
</table>


<h2 class="section-header "><a name="Functions">Functions</a></h2>


<dl class="function">
  <hr />
  <dt>
    <h4><a name="DAO:count">DAO:count</a></h4>
  </dt>
  <dd>
    Count the number of rows.
 Count the number of rows matching the given values.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          (optional) A table containing the fields and values to filter for.
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><span class="type">number</span></span>
        count The total count of rows matching the given filter, or total count of rows if no filter was given.
      </li>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:delete">DAO:delete</a></h4>
  </dt>
  <dd>
    Delete a row.
 Delete a row in table related to this instance. Also deletes all rows with a relashionship to the deleted row
 (via foreign key relations). For SQL databases such as PostgreSQL, the underlying implementation
 leverages "FOREIGN KEY" constraints, but for others such as Cassandra, such operations are executed
 manually.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          A table containing the primary key field(s) for this row.
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        row A table representing the deleted row
      </li>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:find">DAO:find</a></h4>
  </dt>
  <dd>
    Find a row.
 Find a row by its given, mandatory primary key. All other fields are ignored.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          A table containing the primary key field(s) for this row.
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        row The row, or nil if none could be found.
      </li>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:find_all">DAO:find_all</a></h4>
  </dt>
  <dd>
    Find all rows.
 Find all rows in the table, eventually matching the values in the given fields.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          (optional) A table containing the fields and values to search for.
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><span class="type">rows</span></span>
        An array of rows.
      </li>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:find_page">DAO:find_page</a></h4>
  </dt>
  <dd>
    Find a paginated set of rows.
 Find a pginated set of rows eventually matching the values in the given fields.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          (optional) A table containing the fields and values to filter for.
        </li>
        <li>
          <code class="parameter">page_offset</code>
          Offset at which to resume pagination.
        </li>
        <li>
          <code class="parameter">page_size</code>
          Size of the page to retrieve (number of rows).
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        rows An array of rows.
      </li>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:insert">DAO:insert</a></h4>
  </dt>
  <dd>
    Insert a row.
 Insert a given Lua table as a row in the related table.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          Table to insert as a row.
        </li>
        <li>
          <code class="parameter">options</code>
          <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          Options to use for this insertion. (<code>ttl</code>: Time-to-live for this row, in seconds, <code>quiet</code>: does not send event)
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        res A table representing the insert row (with fields created during the insertion).
      </li>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:new">DAO:new</a></h4>
  </dt>
  <dd>
    Instanciate a DAO.
 The DAO Factory is responsible for instanciating DAOs for each entity.
 This method is only documented for clarity.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">db</code>
          An instance of the underlying database object (<code>cassandra_db</code> or <code>postgres_db</code>)
        </li>
        <li>
          <code class="parameter">model_mt</code>
          The related model metatable. Such metatables contain, among other things, validation methods.
        </li>
        <li>
          <code class="parameter">schema</code>
          The schema of the entity for which this DAO is instanciated. The schema contains crucial informations about how to interact with the database (fields type, table name, etc...)
        </li>
        <li>
          <code class="parameter">constraints</code>
          A table of contraints built by the DAO Factory. Such constraints are mostly useful for databases without support for foreign keys. SQL databases handle those contraints natively.
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        self
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:update">DAO:update</a></h4>
  </dt>
  <dd>
    Update a row.
 Update a row in the related table. Performe a partial update by default (only fields in <code>tbl</code> will)
 be updated. If asked, can perform a "full" update, replacing the entire entity (assuming it is valid)
 with the one specified in <code>tbl</code> at once.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          A table containing the new values for this row.
        </li>
        <li>
          <code class="parameter">filter_keys</code>
          <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          A table which must contain the primary key(s) to select the row to be updated.
        </li>
        <li>
          <code class="parameter">options</code>
          <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          Options to use for this update. (<code>full</code>: performs a full update of the entity, <code>quiet</code>: does not send event).
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        res A table representing the updated entity.
      </li>
      <li>
        <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
</dl>


    </div>
  </div>
</div>
</div>


    
  <!-- section class="section subscribe-section" id="newsletter">
  <div class="container">
    <header class="section-header">
      <h4>Keep up with the latest features</h4>
    </header>

    <div class="row">
      <div class="one-half column offset-by-three">

      </div>
    </div>
  </div>
</section -->


<footer class="marketing-footer--light-gray">
  <section>
    <ul>
      <li class="logo-wrapper">
        <div class="logo">
          <img src="/assets/images/qordobalogoblue.png" alt="Qordoba" >
        </div>
      </li>
      <li>
        <nav>
          <h4>Use Cases</h4>
          <ul>
            <li><a href="#">Strings Management</a></li>
            <li><a href="#">Content AI</a></li>
            <li><a href="#">Localization</a></li>
            <li><a href="#">Persona Based Content</a></li>

          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h4>Support</h4>
          <ul>
            <li><a href="https://support.qordoba.com/">Knowledge Base</a></li>
            <li><a href="https://dev.qordoba.com/glossary/">Glossary of Qordoba Terms</a></li>
            <li><a href="https://www.youtube.com/channel/UC_ZMLcfNI1XQnV8frpeFsgA">Webinars</a></li>
            <li><a href="https://www.youtube.com/channel/UC_ZMLcfNI1XQnV8frpeFsgA">Tutorials</a></li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h4>Network Status</h4>
          <ul>
            <li><a href="https://status.qordoba.com/">APIs</a></li>
            <li><a href="https://status.qordoba.com/">SmartSuggest</a></li>
            <li><a href="https://status.qordoba.com/">Emotion and Tone</a></li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h4>Legal</h4>
          <ul>
            <li><a href="#">Terms of Service</a></li>
            <li><a href="#">Privacy Policy</a></li>
          </ul>
        </nav>
      </li>
    </ul>
  </section>

  <section class="legal">
    <ul>
      <li>
        <span class="mashape-footer-content">&copy; Qordoba. 2018</span>
      </li>
      <li>
        <div class="social-link">
          <a href="https://github.com/Qordobacode" title="Github"><i aria-label="Github" class="fa fa-github" aria-hidden="true"></i></a></div>
        <div class="social-link">
          <a href="https://twitter.com/qordoba" title="Twitter"><i aria-label="Twitter" class="fa fa-twitter" aria-hidden="true"></i></a>
        </div>
      </li>
    </ul>
  </section>
</footer>

    <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };
  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];
      if (typeof header.id !== "undefined" && header.id !== "") {
        header.prepend(anchorForId(header.id));
      }
    }
  };
  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      console.log("here")
      var contentBlock = document.getElementById("documentation");
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>


    <script src="/assets/app.js?v=1545351571"></script>

    <div id="fb-root"></div>

    <script id="github-bjs" src="https://buttons.github.io/buttons.js" async defer></script>
    <script id="twitter-wjs" type="text/javascript" src="https://platform.twitter.com/widgets.js" async defer></script>
    <script id="facebook-jssdk" type="text/javascript" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=842731852424506" async defer></script>

    <script type="text/javascript">
      piAId = '393112';
      piCId = '48375';

      (function() {
        function async_load(){
          var s = document.createElement('script'); s.type = 'text/javascript';
          s.src = ('https:' == document.location.protocol ? 'https://pi' : 'http://cdn') + '.pardot.com/pd.js';
          var c = document.getElementsByTagName('script')[0]; c.parentNode.insertBefore(s, c);
        }
        if(window.attachEvent) { window.attachEvent('onload', async_load); }
        else { window.addEventListener('load', async_load, false); }
      })();
    </script>

    <script type='text/javascript'>
      var _vwo_code=(function(){
      var account_id=125292,
      settings_tolerance=2000,
      library_tolerance=2500,
      use_existing_jquery=true,
      // DO NOT EDIT BELOW THIS LINE
      f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
    </script>

    <script type="text/javascript">
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
        analytics.load("WDj0nSS7hpyxwL3evgbOzK755s0NUye6");
        analytics.page()
      }}();
    </script>

    <script type="text/javascript" src="//mashape.github.io/notification-bar/embed.js" async defer></script>
  </body>
</html>
